---
lab:
  az204Title: 'Lab 14 (Optional): Implement containerized solutions'
  az204Module: Optional lab
---

# 랩 14: 컨테이너화된 솔루션 구현

## Microsoft Azure 사용자 인터페이스

Microsoft 클라우드 도구의 동적 특성을 고려할 때 이 교육 콘텐츠를 개발한 후 발생하는 Azure UI 변경이 발생할 수 있습니다. 따라서 랩 지침 및 랩 단계가 올바르게 정렬되지 않을 수 있습니다.

Microsoft는 커뮤니티에서 변경해야 할 사항이 있음을 알려줄 때 이 학습 과정을 업데이트합니다. 그러나 클라우드 업데이트가 자주 이루어지기 때문에 이 학습 콘텐츠가 업데이트되기 전에 UI가 변경될 수 있습니다. **이 경우 변경 사항에 적응하고 필요에 따라 랩에서 작업합니다.**

## Instructions

### 시작하기 전에

#### 랩 환경에 로그인

다음 자격 증명을 사용하여 Windows 10 VM(가상 머신)에 로그인합니다.

- 사용자 이름: `Admin`
- 암호: `Pa55w.rd`

> **참고**: 강사가 가상 랩 환경 연결에 대한 지침을 제공합니다.

#### 설치된 애플리케이션 검토

Windows 10 데스크톱에서 작업 표시줄을 찾습니다. 작업 표시줄에 이 랩에서 사용할 애플리케이션의 아이콘이 포함되어 있습니다.

- Microsoft Edge

## 랩 시나리오

이 랩에서는 .NET 애플리케이션 및 Docker 파일을 사용하여 컨테이너를 만들고 Container Registry에 배포하는 방법을 살펴봅니다.


## 아키텍처 다이어그램

![Azure Content Delivery Network를 사용하여 웹 애플리케이션을 향상시키는 사용자를 보여 주는 아키텍처 다이어그램](./media/Lab14-Diagram.png)

### 연습 1: Azure에서 컨테이너 만들기 및 실행

#### 작업 1: 컨테이너 레지스트리 만들기

1. 작업 표시줄에서 **Microsoft Edge** 아이콘을 선택합니다.

1. 브라우저 창에서 Azure Portal(`https://portal.azure.com`)로 이동한 다음, 이 랩에 사용할 계정으로 로그인합니다.

1. 페이지의 왼쪽 위 모서리에서 + 리소스** 만들기를 선택합니다**.

1. 검색 창에서 Container Registry를 입력**하고 결과에서 Container Registry**를 선택합니다**.**

1. **만들기**를 실행합니다.

1. **컨테이너 레지스트리** 만들기 페이지의 기본 사항** 탭**에서 다음 정보를 입력합니다(다른 사용자는 기본값을 그대로 둡니다.)

    | 설정 | 작업 |
    | -- | -- |
    | **구독** 텍스트 상자 | 기본값을 유지합니다. |
    | **리소스 그룹** 섹션 | 새로 만들기를 선택하고 **acr-sam-rg**를 입력**한 다음 확인을 선택합니다 **.**** |
    | **레지스트리 이름** 섹션 | acrsam**_[yourname]을 입력**합니다._ |
    | **위치** 드롭다운 목록 | **미국 동부**를 선택합니다. |
    | **가격 책정 계획** 드롭다운 목록 | **기본**을 선택합니다. |

1. 검토 + 만들기를 **선택하여 설정을 검토한 다음 만들기**를 선택합니다**.**

   > **참고**: 배포가 완료될 때까지 기다립니다. 몇 분 정도 걸릴 수 있습니다.

1. 개요** 블레이드에서 **리소스**로 이동 단추를 선택하여 **새로 만든 컨테이너 레지스트리 계정의 블레이드로 이동합니다.

1. 컨테이너 레지스트리  **블레이드 **의**설정**  섹션에서 액세스 키를** 선택합니다**.

1. 액세스 키 ** 블레이드에서**관리 사용자를** 사용하도록 설정합니다**.

1. 사용자 이름 ** 상자 값을**클립보드에 복사합니다.
 
1. 메모장 연 다음 복사한 값을 메모장 붙여넣습니다. 나중에 이 랩에서 이 값을 사용하게 됩니다.

축하합니다! Azure에서 Container Registry를 성공적으로 만들었습니다.

#### 작업 2: 컨테이너 이미지를 빌드하는 Docker 파일 만들기

1. **파일 탐색기** 창을 열고 Allfiles(F):\\Allfiles\\Labs\\14 Starter\\webapp-lab14**\\로 이동**한 다음 텍스트 편집기를 엽니다.

1. 프로젝트 디렉터리에 새 파일을 만들고 이름을 지정합니다 `Dockerfile`.

1. Dockerfile**에서 **다음 코드를 추가합니다.

    ```docker

    FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
    WORKDIR /app
    EXPOSE 5151

    ENV ASPNETCORE_URLS=http://+:5151

    # Creates a non-root user with an explicit UID and adds permission to access the /app folder
    # For more info, please refer to https://aka.ms/vscode-docker-dotnet-configure-containers
    RUN adduser -u 5678 --disabled-password --gecos "" appuser && chown -R appuser /app
    USER appuser

    FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
    ARG configuration=Release
    WORKDIR /src
    COPY ["<web-app-name>.csproj", "./"]
    RUN dotnet restore "<web-app-name>.csproj"
    COPY . .
    WORKDIR "/src/."
    RUN dotnet build "<web-app-name>.csproj" -c $configuration -o /app/build

    FROM build AS publish
    ARG configuration=Release
    RUN dotnet publish "<web-app-name>.csproj" -c $configuration -o /app/publish /p:UseAppHost=false

    FROM base AS final
    WORKDIR /app
    COPY --from=publish /app/publish .
    ENTRYPOINT ["dotnet", "<web-app-name>.dll"]

    ```

1. .NET 8 웹 애플리케이션 프로젝트의 이름으로 바꿔 `<web-app-name>` 야 합니다.

1. Dockerfile을 **저장합니다**.

축하합니다! Docker 파일을 성공적으로 만들었습니다.

#### 작업 3: Docker 파일을 사용하여 Azure에서 Linux 컨테이너 만들기

로컬 컴퓨터에 Docker CLI가 설치되어 있는지 확인합니다. 없는 경우 Docker 웹 사이트에서 설치합니다.

1. 작업 표시줄에서 **Windows 터미널** 아이콘을 선택합니다.

1. 열린 명령 프롬프트에 다음 명령을 입력하고 Enter 키를 선택하여 Azure CLI(명령줄 인터페이스)에 로그인합니다.

    ```
    az login
    ```

1. **Microsoft Edge** 브라우저 창에서 Microsoft 계정의 메일 주소 및 암호를 입력한 후, **로그인**을 선택합니다.

1. 현재 열려 있는 Windows 터미널 **명령 프롬프트** 창으로 돌아갑니다. 로그인 프로세스가 완료될 때까지 기다립니다.

1. 다음 명령을 입력한 다음 Enter 키를 선택하여 현재 디렉터리를 **Allfiles(F):\\Allfiles\\Labs\\14\\Starter\\webapp-lab14** 디렉터리로 변경합니다.

    ```
    cd 'F:\Allfiles\Labs\14\Starter\webapp-lab14\'
    ```

1. 다음 명령을 실행하여 컨테이너 레지스트리에 소스 코드를 업로드하고 컨테이너 이미지를 Container Registry 작업으로 빌드하고, <your-registry-name>을 Container Registry의 이름으로 바꾸고> <image-name> 이미지의 새 이름으로 바꿉 있습니다.

    ```
    az acr build --registry <your-registry-name> --image <image-name>:latest .
    ```
    
    > **참고**: 이 랩을 진행하기 전에 빌드 작업이 완료할 때까지 기다립니다.

2. **Windows 터미널** 창을 닫습니다.

3. Azure Portal을 열고 Container Registry로 이동합니다.

4. 컨테이너 레지스트리 블레이드의 ** **서비스** 섹션에서 리포지**토리를 선택합니다**.**

5. Docker 이미지가 리포지토리에 나열되는지 확인합니다.

축하합니다! Docker 파일을 사용하여 Azure에서 Linux 컨테이너를 성공적으로 만들었습니다.

#### 작업 4: Azure 컨테이너 인스턴스에 Linux 컨테이너 이미지 배포

1. Azure Portal에서 페이지의 왼쪽 위 모서리에서 + 리소스** 만들기를 선택합니다**.

1. 검색 창에서 Container Instances를 입력**하고 결과에서 컨테이너 인스턴스**를 선택합니다**.**

1. **만들기**를 실행합니다.

1. **컨테이너 인스턴스** 만들기 페이지의 기본 사항** 탭**에서 다음 정보를 입력하고(다른 정보를 기본값으로 유지) 다음을 선택합니다 **. 네트워킹**:

    | 설정 | 작업 |
    | -- | -- |
    | **구독** 텍스트 상자 | 기본값을 유지합니다. |
    | **리소스 그룹** 드롭다운 목록 | 목록에서 acr-sam-rg** 선택 ** |
    | **컨테이너 이름** 섹션 | acisam**_[yourname]을 입력**합니다._ |
    | **지역** 드롭다운 목록 | **미국 동부**를 선택합니다. |
    | **가용성 영역** 드롭다운 목록 | 1 선택 **** |
    | **이미지 원본** 섹션 | **Azure Container Registry**를 선택합니다. |
    | **레지스트리** 드롭다운 목록 | acrsam**_[yourname] 선택 **_ |
    | **이미지**  드롭다운 목록 | docker-image-name 선택 **** |
    | **이미지 태그**  드롭다운 목록 | docker-image-tag 선택 **** |
    | **OS 유형** 섹션 | **Linux**를 선택합니다. |

1. 네트워킹** 탭에서 **다음 정보를 입력합니다.

    | 설정 | 작업 |
    | -- | -- |
    | **DNS 이름 레이블** 텍스트 상자 | **dns-name 입력** |
    | **포트** 텍스트 상자 | DockerFile에 있는 포트 번호를** 입력**합니다. |
    | **포트 프로토콜** 드롭다운 목록 | 목록에서 TCP** 선택 ** |

1. 검토 + 만들기를 **선택하여 설정을 검토한 다음 만들기**를 선택합니다**.**

   > **참고**: 배포가 완료될 때까지 기다립니다. 몇 분 정도 걸릴 수 있습니다.

1. 개요** 블레이드에서 **리소스**로 이동 단추를 선택하여 **새로 만든 컨테이너 인스턴스 계정의 블레이드로 이동합니다.

1. 컨테이너의 공용 IP 주소를 복사하여 포트 번호로 웹 브라우저에 붙여넣은 다음 Enter 키를 누릅니다.

   `<public-IP-number>:<port-number>` 또는 `<DNS-name>:<port-number>`

1. .NET 웹 애플리케이션의 웹 페이지가 표시됩니다.

축하합니다! 컨테이너 인스턴스에 Linux 컨테이너를 성공적으로 배포했습니다.

#### 작업 5: 기존 컨테이너에 대한 컨테이너 레지스트리 쿼리

1. Azure Portal을 열고 이전에 만든 리소스 그룹으로 이동합니다.

1. 작업 4에서 만든 컨테이너 레지스트리를 선택합니다.

1. 리포지**토리 탭에서 **선택한 다음, 기존 컨테이너에 대해 쿼리할 리포지토리를 선택합니다.

1. **태그** 섹션에서 선택한 리포지토리에 대한 태그 목록을 볼 수 있습니다.

1. 컨테이너 이미지의 세부 정보를 보려면 태그를 선택합니다. 크기, 생성 날짜 및 연결된 계층을 포함하여 컨테이너 이미지에 대한 메타데이터가 표시됩니다.

1. 페이지 맨 위에 있는 검색 창을 사용하여 특정 컨테이너 이미지를 검색할 수도 있습니다. 키워드(keyword) 또는 태그 이름을 입력하고 검색** 단추를 선택**하기만 하면됩니다.
   
1. 컨테이너 이미지를 삭제하려면 태그를 선택한 다음 삭제** 단추를 선택합니다**.
   
   > **참고**: 컨테이너 이미지를 영구적으로 삭제하며 복구할 수 없습니다.

정말 간단하죠. 컨테이너 레지스트리에서 기존 컨테이너를 쿼리하는 방법을 배웠습니다.

#### 검토

이 연습을 완료하여 Container Registry를 만들고, Dockerfile을 만들고, 컨테이너 이미지를 빌드하고, Azure 컨테이너 인스턴스에 Linux 컨테이너를 배포하는 실습 경험을 얻었습니다.


### 연습 2: Azure container Apps 서비스 만들기 및 실행

이 연습에서는 연습 1에서 만든 컨테이너 이미지를 사용하여 컨테이너 앱을 만드는 방법을 알아봅니다.

#### 작업 1: Azure에서 컨테이너 앱 만들기

1. Azure Portal에서 페이지의 왼쪽 위 모서리에서 + 리소스** 만들기를 선택합니다**.

1. 검색 창에서 컨테이너 앱을** 입력**하고 결과에서 컨테이너 앱을** 선택합니다**.

1. **만들기**를 실행합니다.

1. **컨테이너 앱** 만들기 페이지의 기본 사항** 탭**에서 다음 정보를 입력하고(다른 정보를 기본값으로 유지) 다음을 선택합니다 **. 컨테이너**:

    | 설정 | 작업 |
    | -- | -- |
    | **구독** 텍스트 상자 | 기본값을 유지합니다. |
    | **리소스 그룹** 드롭다운 목록 | 목록에서 acr-sam-rg** 선택 ** |
    | **컨테이너 앱 이름** 섹션 | acasam**_[yourname] 입력 **_ |
    | **지역** 드롭다운 목록 | **미국 동부**를 선택합니다. |
    | **Container Apps 환경** 드롭다운 목록 | 기본값을 유지합니다. |

1. 컨테이너 탭에서 **다음 정보를 입력하고 다음: 수신**을 선택합니다**.**

    | 설정 | 작업 |
    | -- | -- |
    | **빠른 시작 이미지** 검사box 사용 | un검사 |
    | **이름** 텍스트 상자 | 미국 동부 입력 **** |
    | **이미지 원본** 드롭다운 목록 | **Azure Container Registry**를 선택합니다. |
    | **레지스트리** 드롭다운 목록 | acrsam**_[yourname] 선택 **_ |
    | **이미지**  드롭다운 목록 | <docker-image-name> 선택합니다 **.** |
    | **이미지 태그**  드롭다운 목록 | **latest**를 선택합니다. |
    | **CPU 및 메모리** 드롭다운 목록 | 목록에서 0.25 CPU 코어, 0.5 Gi 메모** 선택 ** |

1. **수신** 탭에서 다음 정보를 입력합니다.

    | 설정 | 작업 |
    | -- | -- |
    | **수신** 검사box | **사용** 선택 |
    | **수신 트래픽** 상자 | Container Apps 환경으로 제한 선택 **** |
    | **수신 유형** 상자 | **HTTP** 선택 |
    | **클라이언트 인증서 모드** 상자 | 무시 선택 **** |
    | **전송**  드롭다운 목록 | 자동 선택 **** |
    | **대상 포트**  텍스트 상자 | **80**을 입력합니다. |

1. 검토 + 만들기를 **선택하여 설정을 검토한 다음 만들기**를 선택합니다**.**

  > **참고**: 배포가 완료될 때까지 기다립니다. 몇 분 정도 걸릴 수 있습니다.

1. 개요** 블레이드에서 **리소스**로 이동 단추를 선택하여 **새로 만든 컨테이너 앱 계정의 블레이드로 이동합니다.

1. 컨테이너 앱 블레이드에서 **애플리케이션 URL**을 **선택하여 .NET 웹 애플리케이션의 웹 페이지를 확인**합니다.

축하합니다! 컨테이너 앱에 Linux 컨테이너를 성공적으로 배포했습니다.


#### 검토

이 연습을 완료하면 컨테이너 앱을 만들고 Azure 컨테이너 앱에 Linux 컨테이너를 배포하는 실습 경험을 얻게 됩니다.
